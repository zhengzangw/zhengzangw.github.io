<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>5. Data Link Layer | Zangwei</title>

    
    <link rel="stylesheet" href="/scss/main.min.0f39d3a10d2b12312360655e4c36a82b5248ef6d4a7d090e10f0bb9bb1286a06.css" integity="sha256-DznToQ0rEjEjYGVeTDaoK1JI721KfQkOEPC7m7EoagY=">

    <script type="text/javascript" src="/js/dark.js"></script>
<script>
  MathJax = {
    tex: {
      inlineMath: [["$", "$"]],
    },
    displayMath: [
      ["$$", "$$"],
      ["\[\[", "\]\]"],
    ],
    svg: {
      fontCache: "global",
    },
  };

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
></script>
</head><body class="app auto flex-container">
    <div class="flex-container flex-column"><nav>
    <hr>
    <div class="flex-container flex-row flex-row-full">
        
        <div class="nav-item">
            <a href="/about">[ About ]</a>
        </div>
        
        <div class="nav-item">
            <a href="/pdfs/resume.pdf">[ CV ]</a>
        </div>
        
        <div class="nav-item">
            <a href="/teach">[ Teaching ]</a>
        </div>
        
        <div class="nav-item">
            <a href="/posts">[ Posts ]</a>
        </div>
        
        <div class="nav-item">
            <a href="/notes">[ Notes ]</a>
        </div>
        
        <div class="nav-item">
            <a href="/friends">[ Friends ]</a>
        </div>
        
        <div class="nav-item btn btn-switch">
            <a>[ <span class="theme-name">Auto</span> ]</a>
        </div>
    </div>
    <hr>
</nav>
<div class="flex-passage flex-row flex-row-full">
            <div class="flex-column-20">
                <div class="return">
                    <a href=".."> RETURN </a>
                </div>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#提供服务">提供服务</a></li>
    <li><a href="#差错检验">差错检验</a></li>
    <li><a href="#多路访问协议">多路访问协议</a>
      <ul>
        <li><a href="#信道划分协议">信道划分协议</a></li>
        <li><a href="#随机接入协议">随机接入协议</a></li>
        <li><a href="#轮流协议">轮流协议</a></li>
      </ul>
    </li>
    <li><a href="#arp">ARP</a></li>
    <li><a href="#以太网-ieee-8023">以太网 IEEE 802.3</a>
      <ul>
        <li><a href="#以太网帧结构">以太网帧结构</a></li>
        <li><a href="#以太网技术">以太网技术</a></li>
        <li><a href="#局域网数字信号编码">局域网数字信号编码</a></li>
      </ul>
    </li>
    <li><a href="#vlan">VLAN</a></li>
    <li><a href="#mpls">MPLS</a>
      <ul>
        <li><a href="#ldp-标记分发协议-label-distribution-protocal-rfc-5036">LDP 标记分发协议 (Label Distribution Protocal, RFC 5036)</a></li>
      </ul>
    </li>
  </ul>
</nav>
            </div>
            <main class="flex-column-80"><h2 id="提供服务">提供服务</h2>
<ul>
<li>成帧</li>
<li>链路接入
<ul>
<li>点对点链路
<ul>
<li>HDLC: Bit-Oriented Protocols</li>
<li>PPP: Byte-Oriented Protocols</li>
<li>SONET: Clock-Based Framing</li>
</ul>
</li>
<li>广播链路
<ul>
<li>以太网</li>
<li>无线局域网</li>
</ul>
</li>
</ul>
</li>
<li>可靠交付</li>
<li>差错检验与纠正</li>
</ul>
<h2 id="差错检验">差错检验</h2>
<ul>
<li>奇偶校验</li>
<li>因特网检验和：6比特</li>
<li>循环冗余检测</li>
</ul>
<h2 id="多路访问协议">多路访问协议</h2>
<p>广播链路的链路接入，期望特性</p>
<ul>
<li>当仅有一个节点发送数据，$R$ bps 吞吐量</li>
<li>$M$ 个节点发送数据，$\frac{R}{M}$ bps 吞吐量</li>
<li>协议是分散的</li>
<li>协议是简单的</li>
</ul>
<h3 id="信道划分协议">信道划分协议</h3>
<ul>
<li>TDM</li>
<li>FDM</li>
<li>CDMA</li>
</ul>
<h3 id="随机接入协议">随机接入协议</h3>
<h4 id="aloha">ALOHA</h4>
<p>发送$\rightarrow$等待确认$\rightarrow$超时$p$ 概率重传</p>
<ul>
<li>信道最大利用率约 18%
<ul>
<li>$Np(1-p)^{2(N-1)}$</li>
</ul>
</li>
<li>时隙 ALOHA：所有传输只允许在时隙的边界处开始，37%
<ul>
<li>$Np(1-p)^{N-1}$</li>
</ul>
</li>
<li>无法利用局域网和分组无线网的一个重要性质：帧的传播时延小于传输时延
<ul>
<li>小的传播时延提供更好的网络状态反馈信息</li>
</ul>
</li>
</ul>
<h4 id="csma-载波监听多点接入">CSMA (载波监听多点接入)</h4>
<p>Carrier Sensing Multiple Access</p>
<p>监听信道$\rightarrow$发送$\rightarrow$等待确认$\rightarrow$超时重传</p>
<ul>
<li>CS(载波检测)：判断是否有AM/FM信号</li>
<li>LBT: Listen Before Talk</li>
<li>监听算法
<ul>
<li>非持续CSMA：忙则等待一段时间，该时间长度从一个概率分布中获得</li>
<li>$1$ 持续协议：忙则持续监听，空闲立即传输</li>
<li>$p$ 持续CSMA：空闲则有$p$概率直接传输，否则等待一段时间</li>
</ul>
</li>
<li>缺点：两个被破坏帧的传输时间内信道无法使用</li>
</ul>
<h4 id="csmacd-带冲突检测的载波监听多点接入">CSMA/CD (带冲突检测的载波监听多点接入)</h4>
<ul>
<li>$1$ 持续 CSMA + 二进制指数退避
<ul>
<li>发现信道空闲等待 96 比特时间</li>
</ul>
</li>
<li>干扰信号，帧间最小间隔</li>
<li>检测冲突的时间不超过端到端传播时延两倍</li>
<li>CSMA/CD 效率：当有大量的活跃结点，且每个节点有大量帧要发送时，帧在信道中无碰撞传输的那部分时间在长期运行时间中所占比例
<ul>
<li>$d_{\text{prop}}$: 信号能量在任意两个适配器间传播的最大时间</li>
<li>$d_{\text{trans}}$: 传输一个最大长度的以太帧的时间</li>
<li>效率 $=\frac{1}{1+5\frac{d_{\text{prop}}}{d_{\text{trans}}}}$</li>
</ul>
</li>
</ul>
<h5 id="二进制指数退避beb">二进制指数退避(BEB)</h5>
<p>检测到冲突后，节点停止传输，发送干扰序列（JAM序列），之后进行backoff，完成之后可以尝试再次重传</p>
<ol>
<li>基本退避时间一般为端到端的往返时间 $2t$(冲突窗口或争用期)</li>
<li>$k=\min($冲突次数$，10)$</li>
<li>从离散的整数集合${0,1,2，……，(2^k-1)}$中随机的取出一个数$r$，等待时延$2tr$ （等待 $512$ 比特时间）</li>
<li>当冲突次数超过$16$次后，发送失败，丢弃传输的帧，发送错误报告。</li>
</ol>
<h4 id="csmaca-带冲突回避的载波监听多点接入">CSMA/CA (带冲突回避的载波监听多点接入)</h4>
<ul>
<li>IFS(帧间间隔): SIFS,PIFS,DIFS</li>
<li>物理载波监听：信道忙则等待 IFS 时间
<ul>
<li>能量检测</li>
<li>载波侦听</li>
</ul>
</li>
<li>虚拟载波监听：NAV&gt;0 则 NAV 减一</li>
<li>算法
<ul>
<li>CSMA: 若空闲则等待 DIFS 时间后发送，否则</li>
<li>CA: 进行二进制随机退避，侦听到信道空闲递减该值，减到 0 则发送</li>
<li>接受完成后 SIFS 对方发送 ACK</li>
<li>超时则在第二步回退，成功从第二步开始</li>
</ul>
</li>
</ul>
<h3 id="轮流协议">轮流协议</h3>
<ul>
<li>轮询协议：主节点循环的方式轮询(poll)每个节点
<ul>
<li>轮询时延</li>
<li>主节点故障</li>
<li>802.15 协议，蓝牙协议</li>
</ul>
</li>
<li>令牌传递协议
<ul>
<li>IEEE 802.5 令牌环协议</li>
<li>光纤分布式数据接口协议 (FDDI)</li>
</ul>
</li>
</ul>
<h2 id="arp">ARP</h2>
<p>Address Resolution Protocol, RFC 826, 地址解析协议</p>
<ul>
<li>链路层地址与网络接口相关联
<ul>
<li>链路层交换机无链路层地址</li>
<li>LAN 地址/物理地址/MAC 地址</li>
<li>长度 6 字节，共有 $2^{48}$ 个，十六字节表示法</li>
<li>MAC 广播地址：FF-FF-FF-FF-FF-FF</li>
</ul>
</li>
<li>将 IP 地址映射为 MAC 地址
<ul>
<li>只为同一子网上的主机和路由器接口解析 IP 地址</li>
</ul>
</li>
<li>ARP 表：局域网中每个系统维护一张已知IP与子网地址映射的表 <code>arp -a</code></li>
<li>ARP 查询步骤
<ul>
<li>构建 ARP 查询分组并广播</li>
<li>其它主机监听 ARP 查询分组，匹配时答复 ARP 应答分组</li>
<li>原始请求中包括发出请求的主机IP和子网地址，其它主机可将次信息复制到本地表</li>
</ul>
</li>
</ul>
<h2 id="以太网-ieee-8023">以太网 IEEE 802.3</h2>
<p>无连接，不可靠服务</p>
<h3 id="以太网帧结构">以太网帧结构</h3>
<table>
<thead>
<tr>
<th>前同步码</th>
<th>帧开始定界符(SFD)</th>
<th>目的地址</th>
<th>源地址</th>
<th>长度/类型</th>
<th>MAC客户数据(包含填充码)</th>
<th>帧检验序列</th>
<th>扩展</th>
</tr>
</thead>
<tbody>
<tr>
<td>$7$ 字节</td>
<td>$1$</td>
<td>$6$</td>
<td>$6$</td>
<td>$2$</td>
<td>$46\sim1500/1540/1982$</td>
<td>$4$</td>
<td></td>
</tr>
<tr>
<td>01交替序列</td>
<td>10101011</td>
<td></td>
<td></td>
<td></td>
<td>基础帧，Q标志帧，包装帧 MTU</td>
<td>CRC</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="以太网技术">以太网技术</h3>
<p>数据率(Mbps)-信号编码方式-最大网段长度(百米)</p>
<table>
<thead>
<tr>
<th>10Mbps</th>
<th>100Mbps</th>
<th>1000Mbps</th>
<th>10Gbps</th>
</tr>
</thead>
<tbody>
<tr>
<td>10BASE5 同轴电缆($50\Omega$)</td>
<td>100BASE-TX 2对STP/5类UTP</td>
<td>1000BASE-SX 多模光纤</td>
<td>10GBASE-S 多模光纤(300m)</td>
</tr>
<tr>
<td>10BASE2 同轴电缆($50\Omega$)</td>
<td>100BASE-FX 2根光纤</td>
<td>1000BASE-LX 多模光纤</td>
<td>10GBASE-L 单模光纤(10km)</td>
</tr>
<tr>
<td>10BASE-T 无屏蔽双绞线</td>
<td>100BASE-T4 4对3/4/5类UTP</td>
<td>1000BASE-CX 屏蔽双绞线</td>
<td>10GBASE-E 单模光纤(40km)</td>
</tr>
<tr>
<td>10BASE-FP 850nm光纤对</td>
<td></td>
<td>1000BASE-T 4对5类UTP</td>
<td>10GBASE-LX4 单模/多模(10km)</td>
</tr>
</tbody>
</table>
<ul>
<li>IEEE 802.3 100Gbps 规约
<ul>
<li>多通道分发：物理链路多条并行</li>
<li>物理媒体附件子层(PMA)：物理层上，数据链路层下</li>
<li>虚通道：物理媒体附件子层的通信通道</li>
</ul>
</li>
</ul>
<h3 id="局域网数字信号编码">局域网数字信号编码</h3>
<table>
<thead>
<tr>
<th></th>
<th>运用</th>
<th>编码方式</th>
<th>Remark</th>
</tr>
</thead>
<tbody>
<tr>
<td>4B/5B-NRZI</td>
<td>100BASE-X</td>
<td>4比特编码为5个码比特+NRZI</td>
<td>光纤上高效，双绞线上信号能量太过集中，产生不利辐射</td>
</tr>
<tr>
<td>MLT-3</td>
<td>100BASE-TX</td>
<td>4B/5B+NRZ+扰码+扰码后的比特流用 MLT-3 编码</td>
<td></td>
</tr>
<tr>
<td>8B6T</td>
<td>100BASE-T4</td>
<td>每个8比特映射到6个三进制符号上</td>
<td></td>
</tr>
<tr>
<td>8B/10B</td>
<td>光纤通道与千兆位以太网</td>
<td></td>
<td></td>
</tr>
<tr>
<td>64B/66B</td>
<td>10Gbps 100Gbps</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="vlan">VLAN</h2>
<p>虚拟局域网</p>
<ul>
<li>VLAN 交换机连接
<ul>
<li>每个虚拟局域网相接：$N$</li>
<li>VLAN 干线连接：$1$</li>
</ul>
</li>
<li>IEEE 802.1Q VLAN 标准 (扩展以太网帧格式)
<ul>
<li>干线发送侧交换机添加，干线接受侧交换机删除</li>
<li>源地址与类型间 4 字节 VLAN 标签
<ul>
<li>VID: 1~4094</li>
<li>TCI(标签控制信息)：802.3 MAC帧长度/类型=0x8100，则有两个八位组的 TCI字段</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>用户优先级</th>
<th>规范格式指示</th>
<th>VLAN标识符</th>
</tr>
</thead>
<tbody>
<tr>
<td>3bit</td>
<td>1bit</td>
<td>12bit</td>
</tr>
</tbody>
</table>
<h2 id="mpls">MPLS</h2>
<p>多标签交换网络</p>
<ul>
<li>固定长度标签，与 IP 协同工作</li>
<li>MPLS 首部：增加在第二层首部与第三层首部之间
<ul>
<li>标签</li>
<li>预留的 3 比特实验字段</li>
<li>1 比特 S 字段：用于指示成栈</li>
<li>寿命字段 TTL</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>标记值</th>
<th>流量类别 (TC)</th>
<th>栈底比特(S)</th>
<th>TTL</th>
</tr>
</thead>
<tbody>
<tr>
<td>20bits</td>
<td>3</td>
<td>1</td>
<td>8</td>
</tr>
<tr>
<td>仅有本地意义20比特，0~15保留</td>
<td></td>
<td>栈底置1</td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>仅能在两个均为 MPLS 使能的路由器间发送
<ul>
<li>标签交换路由器</li>
<li>基于标签执行交换，不必考虑分组的IP地址</li>
</ul>
</li>
<li>优点
<ul>
<li>交换速度增加</li>
<li>流量管理能力</li>
<li>转发路径的快速恢复</li>
</ul>
</li>
<li>用来提供面向连接的且具有类似区分服务所提供的服务特征的QoS，支持流量管理以提高网络吞吐量，并保持基于IP组网方案的灵活性（2.5层）
<ul>
<li>服务质量支持</li>
<li>流量工程：动态地定义路由，在需求已知的情况下规划资源投入，优化网络的使用之类的能力</li>
<li>支持虚拟专用网络</li>
<li>多协议支持</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>术语</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>标记交换路由器</td>
<td>Label Switching Router</td>
<td>LSR</td>
<td></td>
</tr>
<tr>
<td>转发等价类</td>
<td>Forwarding Equivalence Class</td>
<td>FEC</td>
<td>一组以相同方式转发的分组</td>
</tr>
<tr>
<td>标记交换通路</td>
<td>Label Switched Path</td>
<td>LSP</td>
<td>一定特定的FEC的所有分组经过一个或多个LSR的路径</td>
</tr>
<tr>
<td>标记信息库</td>
<td>Label Information Base</td>
<td>LIB</td>
<td>LSR用以指明一个分组如何被处理的表</td>
</tr>
<tr>
<td>MPLS 域</td>
<td></td>
<td></td>
<td>一个相互连接的支持MPLS路由器的集合</td>
</tr>
</tbody>
</table>
<ul>
<li>基于MPLS VPN
<ul>
<li>客户边缘(CE)：连接到 MPLS 网络的客户设备</li>
<li>提供者边缘(PE)：MPLS 边缘路由器</li>
<li>附着电路(AC)：CE和PE 间工作在链路层的链路</li>
<li>Layer 2 VPN(L2VPN)：基于链路层地址</li>
<li>Layer 3 VPN(L3VPN)：基于IP地址</li>
</ul>
</li>
</ul>
<h3 id="ldp-标记分发协议-label-distribution-protocal-rfc-5036">LDP 标记分发协议 (Label Distribution Protocal, RFC 5036)</h3>
<ul>
<li>报文类型
<ul>
<li>发现：LSR周期性发送 Hello 报文指示存在</li>
<li>会话建立和维持</li>
<li>通告：创建、更改和删除 FEC 标记映射</li>
<li>通知报文
<ul>
<li>差错通知</li>
<li>建议通知</li>
</ul>
</li>
</ul>
</li>
<li>LDP 报文 = 首部+多个报文</li>
<li>首部</li>
</ul>
<table>
<thead>
<tr>
<th>版本</th>
<th>PDU 长度</th>
<th>LDP 表示符</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td></td>
<td>标志 LSR 的唯一性</td>
</tr>
</tbody>
</table>
<ul>
<li>报文</li>
</ul>
<table>
<thead>
<tr>
<th>U比特</th>
<th>报文类型</th>
<th>报文长度</th>
<th>报文ID</th>
<th>必选参数</th>
<th>可选参数</th>
</tr>
</thead>
<tbody>
<tr>
<td>指示如何处理一个位置类型的报文（转发或丢弃）</td>
<td>识别特定报文类型</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</main>
        </div>

    </div>
</body></html>